<!DOCTYPE html>
<html>
<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>You Do It</title>

		<meta name="author" content="Team Mates">

		<link rel="stylesheet" href="./foundation-5.0.2/css/foundation.css">
		<link rel="stylesheet" href="./foundation-icons/foundation-icons.css">
		<link rel="stylesheet" href="./foundation-5.0.2/css/add.css">
		<!--<script src="./foundation-5.0.2/js/modernizr.js"></script>-->
		<meta class="foundation-mq-small">
		<meta class="foundation-mq-medium">
		<meta class="foundation-mq-large">
		<meta class="foundation-mq-xlarge">
		<meta class="foundation-mq-xxlarge">
		<style></style>
		<meta class="foundation-mq-topbar">
		
		<script>
			// Temporary variables
			var roommates = ['Serin', 'Elizabeth'];
			localStorage.setItem('roommates', JSON.stringify(roommates));

			function print_roommates() {
				var roomies = JSON.parse(localStorage.getItem('roommates'));
				for (var i = 0; i < roomies.length; i++) {
					document.write('<div class="row"><div class="small-3 large-2 columns">');
					document.write('<a href="#" class="small button">' + roomies[i] + '</a></div>');
					document.write('<div class="small-3 large-2 columns"><input id = "' + 'roomie' + i.toString() +'" type="text" placeholder="$0.00" /></div></div>');
				}
			}

			// Store information in local storage
			function submit() {
				var moneyinput = trim_whitespace(document.getElementById('money').value);
				var spenton = trim_whitespace(document.getElementById('task').value);
				
				if (moneyinput == "" || spenton == "") {
					alert ("Please fill out all fields")
				}
				else {
					
				}
			}

			function trim_whitespace (str) {
    			return str.replace(/^\s\s*/, "").replace(/\s\s*$/, "");
			}

			// Validate and check money field
			function validate_money() {
				var regex = /^\$?[0-9]+(\.[0-9][0-9])?$/;
				var moneyinput = trim_whitespace(document.getElementById('money').value);
				if (moneyinput != "") {
					if (!regex.test(moneyinput)) {
						alert ("Please enter amount in currency format");
						document.getElementById('money').value = "";
					}
					else {
						var num_regex = /^\d+$/;
						var dollar_regex = /^\$\d+$/;
						if (num_regex.test(moneyinput)){
							document.getElementById('money').value = "$" + moneyinput + ".00";
							distribute_money(parseInt(moneyinput) * 100);
						}
						else if (dollar_regex.test(moneyinput)){
							document.getElementById('money').value = moneyinput + ".00";
							distribute_money(parseInt(moneyinput) * 100);
						}
						else {
							distribute_money(parseInt(parseFloat(moneyinput.replace('$', '')) * 100.0));
						}

					}
				}
			}

			// helper function for validate_money
			function distribute_money(centvalue) {
				var roomies = JSON.parse(localStorage.getItem('roommates'));
				var num_roomies = roomies.length;
				var value = Math.floor(centvalue / parseFloat(num_roomies));
				var distribution = new Array();
				var arraylen = num_roomies;
				while(arraylen--)distribution.push(value);
				console.log(distribution);

				// Obtain distribution of cash between roommates
				var leftovers = centvalue - (num_roomies * value);
				console.log("leftovers: " + leftovers.toString());
				var i = 0;
				while(leftovers--) {
				    distribution[i++] += 1;
				    if (i == distribution.length) i = 0;
				}
				console.log(distribution);

				// Appropriate distribution to inputs
				for (i = 0; i < roomies.length; i++) {
					document.getElementById('roomie' + i.toString()).value = '$' + (distribution[i] / 100.0).toFixed(2).toString();
				}
			}



			
			
		</script>
</head>
<body>
    

<!-- Title Bar -->

	<div class="row">
		<div class="large-12 columns">
			<div class="nav-bar left">
				<ul class="button-group">
					<li><a href="index.html" class="button"><i class="step fi-arrow-left"></i></a></li>
				</ul>
			</div>
			<div class="nav-bar right">
				<ul class="button-group">
					<li><a href="index.html" class="button"><i class="step fi-arrow-right"></i></a></li>
				</ul>
			</div>
			<h1>You Do It</h1>
		</div>
	</div>

<!-- Money / Chore filter -->
	<div class="row">
		<div class="small-centered columns">
			<ul class="button-group">
				<li><a href="#" class="small button disabled">MONEY</a></li>
				<li><a href="./add_chore.html" class="small button">CHORE</a></li>
			</ul>
		</div>
	</div>

<!-- Add new &^$%# -->
	<div class="row">
		<div class="large-12 columns">
			<h4>Add new Item</h4>
		</div>
	</div>

<!-- Form -->
	<div class="row">
		<div class="large-12 columns">
			<form name="addform">
				<div class="row collapse">
					<div class="small-3 large-2 columns">
						<span class="prefix">I spent</span>
					</div>
					<div class="small-9 large-10 columns">
						<input name="amount" id="money" type="text" onblur = "validate_money()" placeholder="$0.00" autofocus/>
					</div>
				</div>

				<div class="row collapse">
					<div class="small-3 large-2 columns">
						<span class="prefix">On</span>
					</div>
					<div class="small-9 large-10 columns">
						<input name="on" id="task" type="text" placeholder="...">
					</div>
				</div>

			</form>
		</div>
	</div>

	<!-- List of roommates -->
	<div class="row">
		<div class="large-12 columns">
			<h4>For</h4>
		</div>
	</div>
	<div class="row">
		<div class="large-12 columns">
			<script>
				print_roommates();
			</script>
		</div>
	</div>

</body>
</html>
